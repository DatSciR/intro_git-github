---
title: "춰Bienvenidos a (R Markdown) Quarto!"
author:
  - name: Julen Astigarraga
    affiliations:
      - Universidad de Alcal치, Forest Ecology and Restoration Group
  - name: Ver칩nica Cruz-Alonso
    affiliations:
      - Graduate School of Design, Harvard University
date: "`r Sys.Date()`"
format:
  html:
    toc: true
    toc-depth: 3
    # css: styles.css
  gfm: default
editor: visual
# format:
#   docx:
#     reference-doc: plantilla.docx
# csl: ecosistemas.csl
# bibliography: references.bib
---

# [R Markdown](https://rmarkdown.rstudio.com)

R Markdown (<https://rmarkdown.rstudio.com/>) empez칩 en 2012 con el objetivo de facilitar la reproducibilidad en R. Ha sido desarrollado principalmente por [Yihui Xie](https://yihui.org/). R Markdown es un formato de archivo para crear documentos din치micos con R que se apoya en [`knitr`](https://yihui.org/knitr/) (paquete para generaci칩n de informes din치micos en R) y [Pandoc](https://pandoc.org/) (conversor de documentos).

R Markdown utiliza programaci칩n literaria, un paradigma de programaci칩n creado por Donald E. Knuth que consiste en escribir la l칩gica del programa en un lenguaje humano (p. ej. ingl칠s, castellano) con fragmentos de c칩digo e instrucciones. R Markdown est치 escrito en Markdown y contiene partes de c칩digo de R (o alg칰n otro lenguaje de programaci칩n) integrado. Algunas de las razones por las que es recomendable utilizar R Markdown son la reproducibilidad, el aumento de la eficiencia de trabajo (a medio-largo plazo), centrarse en el texto sin perder tiempo en el dise침o y la producci칩n de documentos de alta calidad.

## Fundamentos b치sicos de R Markdown

Para crear un archivo R Markdown: *File -\> New File -\> R Markdown*. Debemos cambiar el modelo mental: ahora tendremos un documento fuente de texto plano y a partir de dicho documento generamos un documento renderizado. Estos archivos tienen 3 componentes principales: (i) metadatos, (ii) texto, (iii) c칩digo

-   Metadatos: se escriben entre `` `---` `` al comienzo del archivo. Utiliza la sintaxis de [YAML](https://en.wikipedia.org/wiki/YAML) (Yet Another Markup Language). Se utiliza para evitar teclear manualmente todas las opciones que pueden afectar al c칩digo, al contenido y al proceso de renderizado cada vez que renderizamos el archivo. 춰La sangr칤a es importante!

-   Texto: sintaxis Markdown. Markdown es un formato de texto plano que est치 dise침ado para ser f치cil de escribir y, a칰n m치s importante, f치cil de leer.

-   C칩digo (2 tipos):

    -   Code chunk (bloque de c칩digo): se escribe ```` ```{r} codigo aqui``` ````; entre corchetes se indica el lenguaje. Se puede escribir manualmente, utilizar el atajo `Ctrl + Alt + I` (OS X: `Cmd + Option + I`), utilizar el comando `Insert Code Chunk` en la barra de herramientas del editor o utilizar la paleta de comandos `Ctrl + Shift + P` (OS X `Cmd + Shift + P`).

    -   Inline (en l칤nea): se escribe `codigo aqui`

Para compilar un archivo, se ejecuta el bot칩n de `Render` o `Knit` en RStudio (atajo: `Ctrl + Shift + K`; OS X `Cmd + Shift + K`), que llama a Quarto/R Markdown render en un trabajo de fondo. Esto evita que el renderizado abarrote la consola de R, y as칤 es f치cil de detener.

游 Con el editor visual de RStudio puedes ves en tiempo real c칩mo es la conversi칩n a word, HTML...

Opciones de chunk: <https://bookdown.org/yihui/rmarkdown/r-code.html>

Son compatibles con muchos lenguajes de programaci칩n:

```{r, echo = FALSE, eval = TRUE, warning = FALSE}

library(knitr)

names(knitr::knit_engines$get())

library(reticulate) # for python

```

```{python}

x = "R mola!"

print(x.split(" "))

```

```{r example}

library(ggplot2)
names(cars)

ggplot(cars, aes(speed, dist)) +
  geom_point() +
  geom_smooth()

```

Para buscar ayuda: *Help -\> Markdown Quick Reference* (italics, bold, headers, lists, links, images, R codes, tables, page break, superscripts...)

Formato: **negrita**, *cursiva*, sub칤ndice~1~, super칤ndice^2^, codes, [hyperv칤nculo](https://bookdown.org/yihui/rmarkdown/markdown-syntax.html), notas al pie[^1]

[^1]: hello world

T칤tulos: \# primer nivel; \## segundo nivel...

Listas y sublistas: \*, -, +

Citas:

> "R Markdown es maravilloso pero ojo con Quarto"
>
> --- Julen Astigarraga

F칩rmulas:

$f(os) = {esta \choose gustando} esto^{?} (1-p)^{n-k}$

Comentarios:

<!--# esto es un comentario (atajo: Ctrl + Shift + C; OS X Cmd + Shift + C)-->

Tablas:

| Col1 | Col2 | Col3 |
|------|------|------|
|      |      |      |
|      |      |      |
|      |      |      |

: Esto es el pie de tabla

Figuras:

![Esto es el pie de figura](images/rmarkdown.png)

Videos:

::: {#fig-repro}
<iframe width="560" height="315" src="https://www.youtube.com/embed/s3JldKoA0zw">

</iframe>
:::

### 游닇**Ejercicio 4.1**

Genera un documento R Markdown que est칠 compuesto por al menos metadatos, c칩digo y texto. Tambi칠n puedes a침adir otros elementos, como tablas.

# Quarto

Quarto (<https://quarto.org/>) es un sistema de publicaci칩n cient칤fica y t칠cnica de c칩digo abierto construido sobre Pandoc. Convierte los formatos de texto plano o los formatos mixtos (p. ej. `.qmd`, `.Rmd`, `.md`, `.ipynb`) en informes est치ticos PDF, word, HTML, etc. Puede entrelazar texto narrativo y c칩digo para producir resultados con un formato elegante en forma de documentos, p치ginas web, entradas de blog, libros, etc.

La extensi칩n de Quarto es `.qmd` y utiliza filtros Lua que es el lenguaje de extensi칩n de Pandoc (<https://quarto.org/docs/extensions/lua.html>). Para ello, Quarto utiliza un *engine* como `knitr` para ejecutar el c칩digo y generar una salida temporal `.md`. El archivo `.md` se procesa mediante Pandoc y los filtros Lua de Quarto + Bootstrap CSS para HTML o LaTeX para PDF.

![Figura de jthomasmock.github.io/quarto-2hr-webinar](images/qmd-universe.png)

## R Markdown vs. Quarto

La diferencia principal de Quarto respecto a R Markdown es que se ha generado para la colaboraci칩n de m치s de una comunidad (es decir, no solo usuarios de R o Python) y utiliza una sintaxis y formato compartido entre distintos lenguajes. Adem치s, a medida que se a침ad칤an m치s capacidades a R Markdown a trav칠s de paquetes externos de R, la sintaxis para las tareas b치sicas se volv칤a incoherente.

![Diagrama de funcionamiento de R Markdown. Figura de [jthomasmock.github.io/quarto-2hr-webinar](https://jthomasmock.github.io/quarto-2hr-webinar/)](images/knitr-diagram-rmd.png)

![Diagrama de funcionamiento de Quarto. Figura de [jthomasmock.github.io/quarto-2hr-webinar](https://jthomasmock.github.io/quarto-2hr-webinar/)](images/knitr-diagram-qmd.png)

![Diagramas de funcionamiento de Quarto. Figura de jthomasmock.github.io/quarto-2hr-webinar](images/knitr-diagram-qmd-jupyter.png)

Algunas diferencias entre Quarto y R Markdown en cuanto al c칩digo:

-   Estructura `key: value`

-   `#|` sintaxis *(hash pipe)*. Esta es la sintaxis preferida de Quarto, aunque es compatible con la sintaxis anterior de R Markdown. El *hash pipe* le a침ade m치s consistencia entre los *engine* (Jupyter, knitr) y nos da m치s control sobre el orden o espacio de las opciones del chunk (no est치 limitado a una l칤nea de opciones). No hay ning칰n atajo para un *hash pipe* pero si escribes uno los siguientes se a침adir치n autom치ticamente cuando le das a enter.

-   Tabulaci칩n enriquecida: inicias una palabra y tabulas para completar o `Ctrl + espacio` para ver todas las opciones disponibles.

```{r}
#| echo: true
2 * 2
```

-   Baterias incluidas: Quarto viene preinstalado con las 칰ltimas versiones de RStudio. No se tiene que instalar diferentes paquetes para crear diferentes formatos de salida: <https://quarto.org/docs/output-formats/all-formats.html>

## 쯇or qu칠 utilizar Quarto en lugar de R Markdown?

-   Baterias incluidas

-   Sintaxis compartida (elige tu propio editor y lenguaje preferido)

-   Mejores caracter칤sticas y m치s mejoras en el futuro (R Markdown todav칤a se mantiene, pero la mayor칤a de las nuevas caracter칤sticas ser치n incorporadas en Quarto)

### 游닇**Ejercicio 4.2**

Genera un documento Quarto que tambi칠n est칠 compuesto por al menos metadatos, c칩digo y texto. 쯈u칠 diferencias observas respecto al de R Markdown?

## Renderizaci칩n

Existen tres formas para renderizar un documento en Quarto:

1.  Dentro de RStudio puedes seguir usando el bot칩n de *Render* (antes *knit*, pero ahora llamado *Render* por consistencia)

2.  En el shell mediante quarto render: 游뱁

`quarto render archivo.qmd` (por defecto a HTML)

`quarto render archivo.qmd --to pdf`

`quarto render archivo.qmd --to docx`

`quarto --help`

Sobre la importancia del YAML:

`quarto render archivo.qmd --to html`

`quarto render archivo.qmd --to html -M code-fold:true`

3.  En la consola de R mediante el paquete `quarto`

`library(quarto)`

`quarto_render("archivo.qmd")`

`quarto_render("archivo.qmd", output_format = "pdf")`

## 쯈u칠 hago con mi `.Rmd` o `.ipynb` existentes?

춰No pasa nada! La mayor칤a de los `.Rmd` o `.ipynb` existentes se pueden convertir `as-is` a trav칠s de Quarto. Para hacerlo a trav칠s de la l칤nea de comandos de la terminal se escribe:

`quarto render archivo.Rmd --to html`

Adem치s existen distintas opciones para convertir archivos `.Rmd` a `.qmd`:

1.  Cambiar `.Rmd` a `.qmd` (esto siempre usar치 Quarto para la renderizaci칩n)

2.  Cambiar la salida YAML: `html_document` a `format: html`

3.  `knitr::convert_chunk_header("archivo.Rmd", "archivo.qmd")`

No tienes que convertir la sintaxis de todos tus documentos antiguos. Quarto es compatible con versiones anteriores de R Markdown.

### 游닇**Ejercicio 4.3**

Convierte todos los archivos del ejercicio 4.1 a `.qmd` y renderizalo a HTML y word mediante la opci칩n de renderizaci칩n que m치s te guste.

# Generando el documento final

## Formato

T칤tulos coloreados en azul, el texto no est치 a doble espacio, no hay n칰meros de l칤nea y... 춰manuscrito rechazado! 춰PERO NO VAMOS A EDITAR NADA EN WORD! Podemos asegurarnos de que el `.docx` creado tenga siempre el formato deseado utilizando una plantilla `.docx`. Para utilizarla, la plantilla debe colocarse en la misma carpeta que el archivo `.qmd` y debemos hacer un peque침o ajuste en el YAML.

1.  Primero generamos la plantilla:

    `quarto pandoc -o plantilla.docx \ --print-default-data-file reference.docx`

2.  Modificamos la plantilla generada como la queramos

3.  Lo a침adimos al YAML

```{r}
#| eval: false
format: 
  docx: 
    reference-doc: plantilla.docx
```

## Referencias

Para introducir citas y referencias en nuestro texto en Quarto utilizaremos BibTeX y as칤 evitaremos tener que hacerlo manualmente. Con BibTex, en lugar de escribir la cita se escribe una "clave" 칰nica (clave de citaci칩n: @cita) cada vez que se cita una referencia. Esto permite a los autores cambiar los estilos de las referencias sin tener que reformatear nada manualmente (por ejemplo, si hay que enviar un manuscrito a una revista diferente para su publicaci칩n).

游Recomendamos utilizar [Zotero](https://www.zotero.org/) como gestor bibliogr치fico porque est치 incluido en RStudio, lo que facilita la inclusi칩n de citas y referencias, pero se puede utilizar cualquier otro gestor.

-   Si queremos a침adir las referencias en alg칰n lugar concreto del archivo (ver c칩digo fuente)

::: {#refs}
:::

### 游닇**Ejercicio 4.4**

Genera una plantilla y modifica los colores, tama침o de los t칤tulos, etc. Despu칠s, a침adelo al YAML. A침ade alguna referencia en el documento y renderizalo. Por 칰ltimo, sube este documento al repositorio de GitHub.

# Informaci칩n adicional

-   [Quarto](https://quarto.org)

-   [R Markdown: The Definitive Guide](https://bookdown.org/yihui/rmarkdown/)

-   [Quarto workshop](https://www.youtube.com/watch?v=yvi5uXQMvu4)

-   [What is Quarto? RStudio rolls out next-generation R Markdown](https://www.infoworld.com/article/3666743/what-is-quarto-rstudio-quietly-rolls-out-next-generation-r-markdown.html)

-   [How to create Word docs from R or Python with Quarto](https://www.infoworld.com/article/3671668/how-to-create-word-docs-from-r-or-python-with-quarto.html)

-   [Install TinyTeX to create PDF reports](https://yihui.org/tinytex/)

<details>

<summary>Session Info</summary>

```{r session-info}
Sys.time()
git2r::repository()
sessionInfo()
```

</details>
